<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Cadastro e Login com Supabase</title>
  <style>
    body { background-color: #121212; color: #ffffff; font-family: sans-serif; max-width: 400px; margin: auto; padding: 20px; }
    form { margin-bottom: 20px; }
    input { display: block; margin: 10px 0; padding: 8px; width: 100%; background-color: #1e1e1e; color: #ffffff; border: 1px solid #333; }
    button { padding: 8px 16px; background-color: #6200ea; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #3700b3; }
    #mainContent { display: none; text-align: center; }
    #loginSection { display: none; }
    #status { position: fixed; bottom: 10px; right: 10px; background-color: #333; color: #fff; padding: 5px 10px; border-radius: 5px; }
  </style>
</head>
<body>
  <div id="authSection">
    <h2>Cadastro</h2>
    <form id="cadastroForm">
      <input type="email" id="cadastroEmail" placeholder="Email" required>
      <input type="password" id="cadastroSenha" placeholder="Senha" required>
      <button type="submit">Criar Conta</button>
    </form>
    <button id="showLogin">Já tem uma conta? Faça login</button>

    <div id="loginSection">
      <h2>Login</h2>
      <form id="loginForm">
        <input type="email" id="loginEmail" placeholder="Email" required>
        <input type="password" id="loginSenha" placeholder="Senha" required>
        <button type="submit">Entrar</button>
      </form>
    </div>
  </div>

  <div id="mainContent">
    <h1>Bem-vindo, <span id="userEmail"></span>!</h1>
  </div>

  <div id="msg"></div>
  <div id="status">Conectando ao banco de dados...</div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'

    const supabaseUrl = 'https://jflrqaazwzrnzgiibusv.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpmbHJxYWF6d3pybnpnaWlidXN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDMyMDcxOTUsImV4cCI6MjA1ODc4MzE5NX0.EbHtOfrKZdd_0-q5DoqlWDusi_3aydmg1PENFypIcfE';
    const supabase = createClient(supabaseUrl, supabaseKey);
    const msg = document.getElementById('msg');
    const authSection = document.getElementById('authSection');
    const mainContent = document.getElementById('mainContent');
    const loginSection = document.getElementById('loginSection');
    const userEmail = document.getElementById('userEmail');
    const status = document.getElementById('status');

    document.getElementById('showLogin').addEventListener('click', () => {
      authSection.style.display = 'none';
      loginSection.style.display = 'block';
    });

    // Teste de conexão com o banco de dados
    const checkDatabaseConnection = async () => {
      try {
        const { data, error } = await supabase.from('users').select('*').limit(1);
        if (error) throw error;
        status.textContent = 'Conexão bem-sucedida!';
        status.style.backgroundColor = '#4CAF50'; // Verde
      } catch (err) {
        status.textContent = 'Falha na conexão!';
        status.style.backgroundColor = '#f44336'; // Vermelho
      }
    };

    checkDatabaseConnection();

    // Cadastro de usuário
    document.getElementById('cadastroForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = document.getElementById('cadastroEmail').value;
      const senha = document.getElementById('cadastroSenha').value;
      
      let { error } = await supabase.auth.signUp({ email, password: senha });
      if (error) {
        msg.textContent = 'Erro no cadastro: ' + error.message;
      } else {
        authSection.style.display = 'none';
        loginSection.style.display = 'block';
      }
      this.reset();
    });

    // Login de usuário
    document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = document.getElementById('loginEmail').value;
      const senha = document.getElementById('loginSenha').value;
      
      let { error } = await supabase.auth.signInWithPassword({ email, password: senha });
      if (error) {
        msg.textContent = 'Erro no login: ' + error.message;
      } else {
        authSection.style.display = 'none';
        mainContent.style.display = 'block';
        userEmail.textContent = email;
      }
      this.reset();
    });
  </script>
</body>
</html>
